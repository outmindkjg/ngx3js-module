import * as _RENDERER_NODES from './nodes-renderer.module';
import * as I3JS from '../../../types/three/examples/nodes';

export type ArrayInputNode = I3JS.ArrayInputNode;
export const ArrayInputNode: ArrayInputNode = _RENDERER_NODES.ArrayInputNode as any;

export type AttributeNode = I3JS.AttributeNode;
export const AttributeNode: AttributeNode = _RENDERER_NODES.AttributeNode as any;

export type BypassNode = I3JS.BypassNode;
export const BypassNode: BypassNode = _RENDERER_NODES.BypassNode as any;

export type CodeNode = I3JS.CodeNode;
export const CodeNode: CodeNode = _RENDERER_NODES.CodeNode as any;

export type ContextNode = I3JS.ContextNode;
export const ContextNode: ContextNode = _RENDERER_NODES.ContextNode as any;

export type ExpressionNode = I3JS.ExpressionNode;
export const ExpressionNode: ExpressionNode = _RENDERER_NODES.ExpressionNode as any;

export type FunctionCallNode = I3JS.FunctionCallNode;
export const FunctionCallNode: FunctionCallNode = _RENDERER_NODES.FunctionCallNode as any;

export type FunctionNode = I3JS.FunctionNode;
export const FunctionNode: FunctionNode = _RENDERER_NODES.FunctionNode as any;

export type InputNode = I3JS.InputNode;
export const InputNode: InputNode = _RENDERER_NODES.InputNode as any;

export type Node = I3JS.NodeNode;
export const Node: Node = _RENDERER_NODES.Node as any;

export type NodeNode = I3JS.NodeNode;
export const NodeNode: NodeNode = _RENDERER_NODES.Node as any;

export type NodeAttribute = I3JS.NodeAttribute;
export const NodeAttribute: NodeAttribute = _RENDERER_NODES.NodeAttribute as any;

export type NodeBuilder = I3JS.NodeBuilder;
export const NodeBuilder: NodeBuilder = _RENDERER_NODES.NodeBuilder as any;

export type NodeCode = I3JS.NodeCode;
export const NodeCode: NodeCode = _RENDERER_NODES.NodeCode as any;

export type NodeFrame = I3JS.NodeFrame;
export const NodeFrame: NodeFrame = _RENDERER_NODES.NodeFrame as any;

export type NodeFunctionInput = I3JS.NodeFunctionInput;
export const NodeFunctionInput: NodeFunctionInput = _RENDERER_NODES.NodeFunctionInput as any;

export type NodeKeywords = I3JS.NodeKeywords;
export const NodeKeywords: NodeKeywords = _RENDERER_NODES.NodeKeywords as any;

export type NodeUniform = I3JS.NodeUniform;
export const NodeUniform: NodeUniform = _RENDERER_NODES.NodeUniform as any;

export type NodeVar = I3JS.NodeVar;
export const NodeVar: NodeVar = _RENDERER_NODES.NodeVar as any;

export type NodeVary = I3JS.NodeVary;
export const NodeVary: NodeVary = _RENDERER_NODES.NodeVary as any;

export type PropertyNode = I3JS.PropertyNode;
export const PropertyNode: PropertyNode = _RENDERER_NODES.PropertyNode as any;

export type TempNode = I3JS.TempNode;
export const TempNode: TempNode = _RENDERER_NODES.TempNode as any;

export type VarNode = I3JS.VarNode;
export const VarNode: VarNode = _RENDERER_NODES.VarNode as any;

export type VaryNode = I3JS.VaryNode;
export const VaryNode: VaryNode = _RENDERER_NODES.VaryNode as any;

// accessors
export type CameraNode = I3JS.CameraNode;
export const CameraNode: CameraNode = _RENDERER_NODES.CameraNode as any;

export type MaterialNode = I3JS.MaterialNode;
export const MaterialNode: MaterialNode = _RENDERER_NODES.MaterialNode as any;

export type MaterialReferenceNode = I3JS.MaterialReferenceNode;
export const MaterialReferenceNode: MaterialReferenceNode = _RENDERER_NODES.MaterialReferenceNode as any;

export type ModelNode = I3JS.ModelNode;
export const ModelNode: ModelNode = _RENDERER_NODES.ModelNode as any;

export type ModelViewProjectionNode = I3JS.ModelViewProjectionNode;
export const ModelViewProjectionNode: ModelViewProjectionNode = _RENDERER_NODES.ModelViewProjectionNode as any;

export type NormalNode = I3JS.NormalNode;
export const NormalNode: NormalNode = _RENDERER_NODES.NormalNode as any;

export type Object3DNode = I3JS.Object3DNode;
export const Object3DNode: Object3DNode = _RENDERER_NODES.Object3DNode as any;

export type PointUVNode = I3JS.PointUVNode;
export const PointUVNode: PointUVNode = _RENDERER_NODES.PointUVNode as any;

export type PositionNode = I3JS.PositionNode;
export const PositionNode: PositionNode = _RENDERER_NODES.PositionNode as any;

export type ReferenceNode = I3JS.ReferenceNode;
export const ReferenceNode: ReferenceNode = _RENDERER_NODES.ReferenceNode as any;

export type SkinningNode = I3JS.SkinningNode;
export const SkinningNode: SkinningNode = _RENDERER_NODES.SkinningNode as any;

export type UVNode = I3JS.UVNode;
export const UVNode: UVNode = _RENDERER_NODES.UVNode as any;

// inputs
export type ColorNode = I3JS.ColorNode;
export const ColorNode: ColorNode = _RENDERER_NODES.ColorNode as any;

export type FloatNode = I3JS.FloatNode;
export const FloatNode: FloatNode = _RENDERER_NODES.FloatNode as any;

export type IntNode = I3JS.IntNode;
export const IntNode: IntNode = _RENDERER_NODES.IntNode as any;

export type Matrix3Node = I3JS.Matrix3Node;
export const Matrix3Node: Matrix3Node = _RENDERER_NODES.Matrix3Node as any;

export type Matrix4Node = I3JS.Matrix4Node;
export const Matrix4Node: Matrix4Node = _RENDERER_NODES.Matrix4Node as any;

export type TextureNode = I3JS.TextureNode;
export const TextureNode: TextureNode = _RENDERER_NODES.TextureNode as any;

export type Vector2Node = I3JS.Vector2Node;
export const Vector2Node: Vector2Node = _RENDERER_NODES.Vector2Node as any;

export type Vector3Node = I3JS.Vector3Node;
export const Vector3Node: Vector3Node = _RENDERER_NODES.Vector3Node as any;

export type Vector4Node = I3JS.Vector4Node;
export const Vector4Node: Vector4Node = _RENDERER_NODES.Vector4Node as any;

// display
export type ColorSpaceNode = I3JS.ColorSpaceNode;
export const ColorSpaceNode: ColorSpaceNode = _RENDERER_NODES.ColorSpaceNode as any;

export type NormalMapNode = I3JS.NormalMapNode;
export const NormalMapNode: NormalMapNode = _RENDERER_NODES.NormalMapNode as any;

// math
export type MathNode = I3JS.MathNode;
export const MathNode: MathNode = _RENDERER_NODES.MathNode as any;

export type OperatorNode = I3JS.OperatorNode;
export const OperatorNode: OperatorNode = _RENDERER_NODES.OperatorNode as any;

// lights
export type LightContextNode = I3JS.LightContextNode;
export const LightContextNode: LightContextNode = _RENDERER_NODES.LightContextNode as any;

export type LightNode = I3JS.LightNode;
export const LightNode: LightNode = _RENDERER_NODES.LightNode as any;

export type LightsNode = I3JS.LightsNode;
export const LightsNode: LightsNode = _RENDERER_NODES.LightsNode as any;

// utils
export type ArrayElementNode = I3JS.ArrayElementNode;
export const ArrayElementNode: ArrayElementNode = _RENDERER_NODES.ArrayElementNode as any;

export type ConvertNode = I3JS.ConvertNode;
export const ConvertNode: ConvertNode = _RENDERER_NODES.ConvertNode as any;

export type JoinNode = I3JS.JoinNode;
export const JoinNode: JoinNode = _RENDERER_NODES.JoinNode as any;

export type SplitNode = I3JS.SplitNode;
export const SplitNode: SplitNode = _RENDERER_NODES.SplitNode as any;

export type SpriteSheetUVNode = I3JS.SpriteSheetUVNode;
export const SpriteSheetUVNode: SpriteSheetUVNode = _RENDERER_NODES.SpriteSheetUVNode as any;

export type OscNode = I3JS.OscNode;
export const OscNode: OscNode = _RENDERER_NODES.OscNode as any;

export type TimerNode = I3JS.TimerNode;
export const TimerNode: TimerNode = _RENDERER_NODES.TimerNode as any;

// procedural
export type CheckerNode = I3JS.CheckerNode;
export const CheckerNode: CheckerNode = _RENDERER_NODES.CheckerNode as any;

export type NodeUpdateType = I3JS.NodeUpdateType;
export const NodeUpdateType: NodeUpdateType = _RENDERER_NODES.NodeUpdateType as any;

export type ClassLib = I3JS.NodeEditorClassLib;
export const ClassLib: ClassLib = _RENDERER_NODES.ClassLib as any;

export type NodeEditor = I3JS.NodeEditor;
export const NodeEditor: NodeEditor = _RENDERER_NODES.NodeEditor as any;

export type PointsNodeMaterial = I3JS.PointsNodeMaterial;
export const PointsNodeMaterial: PointsNodeMaterial = _RENDERER_NODES.PointsNodeMaterial as any;

export type OnNodeBuildBeforeRender = I3JS.OnNodeBuildBeforeRender;
export const OnNodeBuildBeforeRender: OnNodeBuildBeforeRender = (nodeFrame: any, material: any) => {
	material.onBuild = (object: any, parameters: any, renderer: any) => {
		builders.set(material, new _RENDERER_NODES.WebGLNodeBuilder(object, renderer, parameters).build());
	};
	material.onBeforeRender = (renderer: any, scene: any, camera: any, geometry: any, object: any) => {
		const nodeBuilder = builders.get(material);
		if (nodeBuilder !== undefined) {
			nodeFrame.material = material;
			nodeFrame.camera = camera;
			nodeFrame.object = object;
			nodeFrame.renderer = renderer;
			for (const node of nodeBuilder.updateNodes) {
				nodeFrame.updateNode(node);
			}
		}
	};
};

export const SetNodeAssetLibPath = (path: any) => {
	assetLibPath = path;
}

const builders = new WeakMap();

let assetLibPath : string = '';

if (_RENDERER_NODES.NodeEditorLoader.prototype._load === undefined) {
	_RENDERER_NODES.NodeEditorLoader.prototype._load = _RENDERER_NODES.NodeEditorLoader.prototype.load;
	_RENDERER_NODES.NodeEditorLoader.prototype.load = async function( url : any, lib : any = null ) {
		return this._load(assetLibPath + url, lib);
	}
}

